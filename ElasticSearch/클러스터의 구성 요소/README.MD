# 클러스터의 구성 요소

 엘라스틱서치는 기본적으로 클러스터라는 단위로 데이터를 제공합니다. 클러스터는 하나 이상의 물리적인 노드로 이뤄져 있으며 각 노드는 모두 데이터 색인 및 검색 기능을 제공하는 일종의 물리적인 서버이기도 합니다. **내부에는 루씬 라이브러리가 자리 잡고 있으며 이는 엘라스틱서치의 근간을 이루는 핵심 모듈입니다.**

## 클러스터 (Cluster)

 클러스터는 데이터를 실제로 가지고 있는 노드의 모음입니다. 엘라스틱서치에서는 관련된 모든 노드들을 논리적으로 확장해서 클러스터라고 부릅니다. 같은 클러스터 내부의 데이터만 서로 공유가 가능하기 때문에 연관된 노드들이 하나의 클러스터로 연결되도록 설정을 해주어야 합니다. 이를 위해 **같은 클러스터를 구성하는 노드들은 같은 클러스터 이름으로 설정해야 합니다.** 클러스터 내부의 노드들은 평소 데이터를 색인이나 검색 작업을 함께 수행하게 되고 장애가 발생했을 때 데이터 복구를 위한 다양한 작업도 서로 협력해서 함께 진행합니다.

## 노드 (Node)

 물리적으로 실행된 런타임 상태의 엘라스틱서치를 노드라고 부릅니다. 노드는 논리적인 클러스터를 이루는 구성원의 일부이며 실제 데이터를 물리적으로 가지고 있는 단일 서버이기도 합니다. 실행 시 노드는 클러스터에 의해 UUID(Universally Unique IDentifier)가 할당되고 클러스터 내에서는 할당된 UUID로 서소를 식별합니다. 기본값으로 부여되는 UUID를 원하지 않는다면 직접 원하는 이름을 설정할 수도 있습니다.

 같은 클러스터 내부에 존재하는 모든 노드는 서로 다른 노드와 수시로 정보를 주고 받습니다. 노드는 목적과 역할에 따라 다음과 같은 형태로 실행할 수 있습니다.

-   마스터 노드(Master Node) : node.master 설정이 true로 설정된 노드이며 클러스터의 제어를 담당합니다.
-   데이터 노드(Data Node) : node.data 설정이 true로 설정된 노드입니다. 데이터를 저장하고, CRUD, 검색, 집계 등 데이터 관련 작업을 담당합니다.
-   인제스트 노드(Ingest Node) : node.ingest가 true로 설정된 노드입니다. 색인 전 전처리 작업을 담당합니다.
-   코디네이팅 노드(Coordinating Node) : 검색이나 집계 시 분산 처리만을 목적으로 설정된 노드입니다. 대량의 데이터를 처리할 경우에 효율적으로 사용할 수 있는 노드입니다.

## 인덱스 (Index)

 엘라스틱서치 인덱스는 유사한 특성을 가지고 있는 문서를 모아둔 문서들의 컬렉션입니다. **클러스터 내부에 생성되는 모든 인덱스는 클러스터 내에서 유니크한 인덱스명을 가져야하며, 모두 소문자로 설정되어야 합니다.**

## 문서 (Document)

 문서는 검색 대상이 되는 실제 물리적인 데이터를 뜻합니다. 문서는 인덱스를 생성할 수 있는 기본적인 정보 단위입니다. 인덱스에는 원하는 만큼의 많은 문서를 저장할 수 있으며 실제로는 물리적인 샤드 형태로 나눠져서 다수의 노드로 분산 저장됩니다.

## 샤드 (Shard)

 인덱스에는 매우 많은 양의 문서가 저장될 수 있습니다. 이러한 이유로 하드웨어의 물리적인 한계를 넘기위해 샤드라는 개념을 도입하였습니다. 이를 이용하면 데이터를 분산 저장하는 방식으로 손쉬운 **수평 확장**이 가능해집니다. 샤드의 개수는 원하는 만큼 설정할 수 있습니다. 샤드는 전체 데이터의 부분집합이지만 각 샤드는 자신이 가지고 있는 데이터만으로도 독립적인 검색 서비스가 가능합니다.

 실제로 인덱스에 쿼리를 요청하면 인덱스가 가지고 있는 모든 샤드로 검색 요청이 전달되고 각 샤드에서 1차적으로 검색이 이뤄진 후 그 결과를 취합해서 최종 결과로 제공됩니다. 결과적으로 **여러 노드에서 샤드를 통해 분산 처리되므로 성능이나 처리량을 향상시킬 수 있습니다.**

---

## 참고자료

[엘라스틱서치 실무 가이드](http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&mallGb=KOR&barcode=9791158391485&orderClick=LAG&Kc=) <<권택환, 김동우, 김흥래, 박진현, 최용호, 황희정 지음>>